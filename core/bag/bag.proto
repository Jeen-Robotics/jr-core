syntax = "proto3";

package jr.mw;

// Compression types
enum CompressionType {
  COMPRESSION_NONE = 0;
  COMPRESSION_ZSTD = 1;
}

// Header written at the beginning of a bag file
message BagHeader {
  uint32 version = 1;
  string format_id = 2;  // e.g., "JR_BAG"
  CompressionType compression = 3;  // Compression used for records
}

// A single recorded message
message BagRecord {
  string topic = 1;
  string type_full_name = 2;
  bytes payload = 3;           // Serialized protobuf message
  uint64 timestamp_ns = 4;     // Nanoseconds since epoch
}

// Container for multiple records (optional, for streaming)
message BagRecordBatch {
  repeated BagRecord records = 1;
}

// Video codec types
enum VideoCodec {
  VIDEO_CODEC_H264 = 0;
  VIDEO_CODEC_H265 = 1;
  VIDEO_CODEC_MJPEG = 2;
}

// Reference to a frame in an external video file
message VideoFrameReference {
  string topic = 1;
  string video_file = 2;      // Relative path to video file (e.g., "bagname_topic.avi")
  uint64 frame_index = 3;     // Frame index in the video file
  uint32 width = 4;
  uint32 height = 5;
  string encoding = 6;        // Original image encoding (e.g., "8UC3")
  uint32 seq = 7;             // Sequence number from original message
}
